<html>
    <head>
        <meta charset="utf-8" />
        <title>
            Mocap Vizualization Test
        </title>     
    </head>
    
    <body>

        Data: <input type="file" id="dataFileInput" name="dataFileInput" accept=".data,.txt">
        <br>

        Samples: <input type="file" id="sampleFileInput" name="sampleFileInput" accept=".json">
        <br>

        <label for="context">Choose a context:</label>
        <select name="context" id="context">
            <option value="1">No context</option>
            <option value="2">Sampled context</option>
            <option value="3">Built context</option>
        </select>
        <br>

        <button id="dataLoadButton">Load Data</button>


        <br>
        <br>
        <br>
        <br>
        Data for sampling: <input type="file" id="sampleDataFileInput" name="sampleDataFileInput" accept=".data,.txt">
        <br>
        <button id="sampleDataButton">Sample Data</button>

        <script type="module">
            import * as Mocap from '../src/mocap.js';
            import * as VS from '../src/ComparisonVizualization/VisualizationService.js';

            const dataFileInput = document.getElementById("dataFileInput");
            const sampleFileInput = document.getElementById('sampleFileInput');
            const sampleDataFileInput = document.getElementById("sampleDataFileInput");

            const contextSelect = document.getElementById("context");
            const loadButton = document.getElementById("dataLoadButton");
            const sampleButton = document.getElementById("sampleDataButton");

            let contextOption = VS.ContextOption.NO_CONTEXT;

            let context = document.getElementById('context');
            contextSelect.onchange = setContext;
            loadButton.onclick = load;
            sampleButton.onclick = sample;

            let jsonContent = "";

            let factory = new Mocap.VisualizationFactory();
            factory.numKeyframes = 8;
            factory.numZoomedKeyframes = 10;
            factory.keyframeSelectionAlgorithm = Mocap.KeyframeSelectionAlgorithmEnum.Equidistant;
            factory.leftBoneStyle = {r: 0, g: 180, b: 0, a: 1};
            factory.opacity = 0.6;
            factory.blurFrameOpacity = 0.17;

            function load() {
                if (dataFileInput.files.length === 0) {
                    console.log("No file selected!");
                    return;
                }

                if (sampleFileInput.files.length !== 0) {
                    const reader = new FileReader()
                    reader.onload = handleFileLoad;
                    reader.readAsText(sampleFileInput.files[0]);
                }

                Mocap.loadDataFromFile(dataFileInput.files[0], (sequences) => {
                    let visualizationElement = factory.visualizeSequenceDifferences(sequences[1918], sequences[1236], 1400, contextOption, jsonContent);

                    document.body.appendChild(visualizationElement);
                });
            }

            function sample() {
                if (sampleDataFileInput.files.length === 0) {
                    console.log("No file selected!");
                    return;
                }

                Mocap.loadDataFromFile(sampleDataFileInput.files[0], (sequences) => {
                    factory.sampleData(sequences, 1);
                });
            }

            function setContext() {
                //const contextSelect = document.getElementById("context");
                contextOption = contextSelect.value;
                console.log(contextOption);
            }

            function handleFileLoad(event) {
                jsonContent = event.target.result;
            }
        </script>
    </body>
</html>