<html>
    <head>
        <meta charset="utf-8" />
        <title>
            Mocap Vizualization Test
        </title>     
    </head>
    
    <body>

        Data: <input type="file" id="dataFileInput" name="dataFileInput" accept=".data,.txt">

        Samples: <input type="file" id="sampleFileInput" name="sampleFileInput" accept=".json">

        <label for="context">Choose a context:</label>

        <select name="context" id="context">
            <option value="1">No context</option>
            <option value="2">Sampled context</option>
            <option value="3">Built context</option>
        </select>

        <button id="dataLoadButton">Load Data</button>
        <button id="sampleDataButton">Sample Data</button>

        <script type="module">
            import * as Mocap from '../src/mocap.js';
            import * as VS from '../src/ComparisonVizualization/VisualizationService.js';

            const dataFileInput = document.getElementById("dataFileInput");
            const sampleFileInput = document.getElementById('sampleFileInput');

            const contextSelect = document.getElementById("context");
            const loadButton = document.getElementById("dataLoadButton");
            const sampleButton = document.getElementById("sampleDataButton");

            let contextOption = VS.ContextOption.NO_CONTEXT;

            let context = document.getElementById('context');
            contextSelect.onchange = setContext;
            loadButton.onclick = load;
            sampleButton.onclick = sample;

            let jsonContent = "";

            function load() {
                if (dataFileInput.files.length === 0) {
                    console.log("No file selected!");
                    return;
                }

                if (sampleFileInput.files.length !== 0) {
                    const reader = new FileReader()
                    reader.onload = handleFileLoad;
                    reader.readAsText(sampleFileInput.files[0]);
                }

                Mocap.loadDataFromFile(dataFileInput.files[0], (sequences) => {
                    let factory = new Mocap.VisualizationFactory();
                    factory.numKeyframes = 8;
                    factory.numZoomedKeyframes = 10;
                    factory.keyframeSelectionAlgorithm = Mocap.KeyframeSelectionAlgorithmEnum.Equidistant;
                    factory.leftBoneStyle = {r: 0, g: 180, b: 0, a: 1};
                    factory.opacity = 0.6;
                    factory.blurFrameOpacity = 0.17;
                    // factory.sampling(sequences, 1);
                    // console.log(sampleAverage);
                    // console.log(factory.getIndexOfSequenceById(sequences, "3405_91_539_126"));
                    console.log(contextOption);
                    let visualizationElement = factory.visualizeSequenceDiffs(sequences[1918], sequences[1236], 1400, 200, 200, 200, contextOption, jsonContent);

                    document.body.appendChild(visualizationElement);
                });
            }

            function sample() {
                if (dataFileInput.files.length === 0) {
                    console.log("No file selected!");
                    return;
                }

                if (sampleFileInput.files.length !== 0) {
                    const reader = new FileReader()
                    reader.onload = handleFileLoad;
                    reader.readAsText(sampleFileInput.files[0]);
                }

                Mocap.loadDataFromFile(dataFileInput.files[0], (sequences) => {
                    let factory = new Mocap.VisualizationFactory();
                    factory.numKeyframes = 8;
                    factory.numZoomedKeyframes = 10;
                    factory.keyframeSelectionAlgorithm = Mocap.KeyframeSelectionAlgorithmEnum.Equidistant;
                    factory.leftBoneStyle = {r: 0, g: 180, b: 0, a: 1};
                    factory.opacity = 0.6;
                    factory.blurFrameOpacity = 0.17;

                    factory.sampling(sequences, 1);
                });
            }

            function setContext() {
                //const contextSelect = document.getElementById("context");
                contextOption = contextSelect.value;
                console.log(contextOption);
            }

            function handleFileLoad(event) {
                jsonContent = event.target.result;
            }
        </script>
    </body>
</html>